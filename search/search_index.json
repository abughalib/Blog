{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Abu","text":"<p>Hi Welcome to Abu's Blog WebPage. I like experimenting with things. I created this page so that I can share some of those with you.</p>"},{"location":"#about-me","title":"About Me","text":"<p>I'm an Associate Software Engineer at Finastra. I work with new tech in and out of my Workplace. We connect on LinkedIn if you want to say Hi Abu Ghalib</p>"},{"location":"blog/2023/12/22/openvpn-behind-cgnat/","title":"OpenVPN Behind CGNAT","text":"<p>If you're in a situation where you don't have static IP and you can't port forward to WAN.</p> <ul> <li>What is CGNAT</li> </ul>"},{"location":"blog/2023/12/22/openvpn-behind-cgnat/#requirements","title":"Requirements","text":"<ul> <li>Router with Portforwarding</li> <li>Ngrok Checkout Setup or Web Relay</li> </ul>"},{"location":"blog/2023/12/22/openvpn-behind-cgnat/#using-ngrok","title":"Using Ngrok","text":"<ol> <li>Install Ngrok</li> <li> <p>Start ngrok on TCP 443</p> <pre><code>sudo ngrok tcp 443\n</code></pre> <p>You would get something like number.tcp.region.ngrok.io:random-port-forward-number</p> <pre><code>ngrok                         (Ctrl+C to quit)\nSession Status                online\nAccount                       XXXYYYYYY (Plan: XXXX)\nVersion                       3.19.0\nRegion                        Country (country_code)\nLatency                       7ms\nWeb Interface                 http://127.0.0.1:4040\nForwarding                    tcp://x.tcp.xx.ngrok.io:xxxxx -&gt; localhost:443\n\nConnections                   ttl     opn     rt1     rt5     p50     p90\n</code></pre> <p>Keep this running and take a note tcp://x.tcp.xx.ngrok.io:xxxxx</p> </li> <li> <p>In Free account you get Data Transfer Out of 1GB as of now.</p> </li> </ol>"},{"location":"blog/2023/12/22/openvpn-behind-cgnat/#using-webrelay-not-available-on-windows","title":"Using WebRelay (Not Available on Windows)","text":"<ul> <li> <p>Get the webrelay binary.</p> <pre><code>curl -LO https://dl.webrelay.dev/linux/x64/webrelay &amp;&amp; chmod +x webrelay\n</code></pre> </li> <li> <p>Login</p> <pre><code>webrelay login &lt;your-email-id&gt;\n</code></pre> <p>An OTP is sent to your mail, Enter that OTP.</p> <pre><code>? Enter the token you received in your email: xxxxxx\nLogin successful\n</code></pre> </li> <li> <p>Start WebRelay on TCP Port</p> <pre><code>./webrelay tcp -p 443\n</code></pre> <pre><code>./webrelay tcp -p 443\nTunnel available at -&gt; srv.webrelay.dev:xxxxx\n</code></pre> </li> <li> <p>Its Free only requires email to sign up</p> </li> </ul>"},{"location":"blog/2023/12/22/openvpn-behind-cgnat/#checkenable-firewall-settings","title":"Check/Enable Firewall Settings","text":"<ul> <li> <p>using <code>ufw</code></p> <pre><code>sudo ufw allow 443/tcp\nsudo ufw enable\n</code></pre> </li> <li> <p>If using <code>iptables</code></p> <pre><code>sudo iptables -A INPUT -p tcp --dport 443 -j ACCEPT\n</code></pre> </li> <li> <p>Save the rules</p> <pre><code>sudo netfilter-persistent save\n</code></pre> </li> </ul>"},{"location":"blog/2023/12/22/openvpn-behind-cgnat/#install-openvpn-server-on-linux","title":"Install OpenVPN Server on Linux","text":"<p>I'm using Debian 12 &amp; TP-Link Router Archer C6</p>"},{"location":"blog/2023/12/22/openvpn-behind-cgnat/#install-openvpn-and-easy-rsa","title":"Install OpenVPN and Easy-RSA","text":"<pre><code>sudo apt update &amp;&amp; sudo apt upgrade -y\nsudo apt install openvpn easy-rsa -y\n</code></pre>"},{"location":"blog/2023/12/22/openvpn-behind-cgnat/#setup-the-public-key-infrastructure-pki","title":"Setup the Public Key Infrastructure (PKI)","text":"<ul> <li> <p>Create the Easy-RSA Directory</p> <pre><code>make-cadir ~/openvpn-ca\ncd ~/openvpn-ca\n</code></pre> </li> <li> <p>Configure the PKI Variables, Edit the <code>vars</code> file:</p> <pre><code>vi vars\n</code></pre> <p>Modify and Add the Following lines.</p> <pre><code>set_var EASYRSA_REQ_COUNTRY    \"YourCountry\"\nset_var EASYRSA_REQ_PROVINCE   \"YourProvince\"\nset_var EASYRSA_REQ_CITY       \"YourCity\"\nset_var EASYRSA_REQ_ORG        \"YourOrg\"\nset_var EASYRSA_REQ_EMAIL      \"YourEmail@example.com\"\nset_var EASYRSA_REQ_OU         \"YourOrgUnit\"\n</code></pre> </li> <li> <p>Initialize the PKI</p> <pre><code>./easyrsa init-pki\n</code></pre> <p>Output</p> <pre><code>abu@ABU-PC:~/openvpn-ca$ ./easyrsa init-pki\n* Notice:\n\n    init-pki complete; you may now create a CA or requests.\n\n    Your newly created PKI dir is:\n    * /home/abu/openvpn-ca/pki\n</code></pre> </li> <li> <p>Build the Certificate Authority (CA)</p> <pre><code>./easyrsa build-ca\n</code></pre> <p>Set a password and Remember it</p> <pre><code>abu@ABU-PC:~/openvpn-ca$ ./easyrsa build-ca\n* Notice:\nUsing Easy-RSA configuration from: /home/abu/openvpn-ca/vars\n\n* WARNING:\n\n    Move your vars file to your PKI folder, where it is safe!\n\n* Notice:\nUsing SSL: openssl OpenSSL 3.0.15 3 Sep 2024 (Library: OpenSSL 3.0.15 3 Sep 2024)\n\n\nEnter New CA Key Passphrase:\nRe-Enter New CA Key Passphrase:\nUsing configuration from /home/abu/openvpn-ca/pki/8273b3c0/temp.058c7933\n..........+..+...+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.....................+...+............+..+.......+........+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\n...+.+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*..+..+...+.......+...+...+.....+.+........+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.........+.....+...+....+.....+.+............+...+...........+...+......+.+......+...+.....+....+..+...+.+...........+..................+..........+..+...+.......+.....+.+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\nEnter PEM pass phrase:\nVerifying - Enter PEM pass phrase:\n-----\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\nCommon Name (eg: your user, host, or server name) [Easy-RSA CA]:home_network\n\n* Notice:\n\nCA creation complete and you may now import and sign cert requests.\nYour new CA certificate file for publishing is at:\n/home/abu/openvpn-ca/pki/ca.crt\n</code></pre> </li> </ul>"},{"location":"blog/2023/12/22/openvpn-behind-cgnat/#generate-server-certificates-and-keys","title":"Generate Server Certificates and Keys","text":"<ol> <li> <p>Generate a key Pair for the server</p> <pre><code>./easyrsa gen-req server nopass\n</code></pre> <pre><code>abu@ABU-PC:~/openvpn-ca$ ./easyrsa gen-req server nopass\n* Notice:\nUsing Easy-RSA configuration from: /home/abu/openvpn-ca/vars\n\n* WARNING:\n\n    Move your vars file to your PKI folder, where it is safe!\n\n* Notice:\nUsing SSL: openssl OpenSSL 3.0.15 3 Sep 2024 (Library: OpenSSL 3.0.15 3 Sep 2024)\n\n.....+...+.+.........+........+....+...+...+...+.....+.+...+...+..+.....................+.......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*..........+...+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*........+.....+.+.........+.....+.+..................+...+...+.........+......+...........+...+.+..+.......+...........+....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\n..+..+.+.....+...............+......+....+.....+.......+..+.+.........+..+......+...+.+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*......+......+..+...+....+.....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.+...+..+.+.............................+.+.....+....+..............+.........+.+......+...+...+..+.............+........+.......+..+...+....+.....+.+...+..+.......+.....+.+..+.........+...+......+...............+.......+..+.+......+......+..+.......+...+..+...+......+......+......+............+...+....+........+.+..+....+...+.....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\n-----\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\nCommon Name (eg: your user, host, or server name) [server]:home_network\n* Notice:\n\nKeypair and certificate request completed. Your files are:\nreq: /home/abu/openvpn-ca/pki/reqs/server.req\nkey: /home/abu/openvpn-ca/pki/private/server.key\n</code></pre> </li> <li> <p>Sign the server Certificate</p> <pre><code>./easyrsa sign-req server server\n</code></pre> <pre><code>abu@ABU-PC:~/openvpn-ca$ ./easyrsa sign-req server server\n* Notice:\nUsing Easy-RSA configuration from: /home/abu/openvpn-ca/vars\n\n* WARNING:\n\n    Move your vars file to your PKI folder, where it is safe!\n\n* Notice:\nUsing SSL: openssl OpenSSL 3.0.15 3 Sep 2024 (Library: OpenSSL 3.0.15 3 Sep 2024)\n\n\nYou are about to sign the following certificate.\nPlease check over the details shown below for accuracy. Note that this request\nhas not been cryptographically verified. Please be sure it came from a trusted\nsource or that you have verified the request checksum with the sender.\n\nRequest subject, to be signed as a server certificate for 825 days:\n\nsubject=\n    commonName                = home_network\n\n\nType the word 'yes' to continue, or any other input to abort.\n    Confirm request details: yes\n\nUsing configuration from /home/abu/openvpn-ca/pki/ea6e6305/temp.e2dbb5e4\nEnter pass phrase for /home/abu/openvpn-ca/pki/private/ca.key:\nCheck that the request matches the signature\nSignature ok\nThe Subject's Distinguished Name is as follows\ncommonName            :ASN.1 12:'home_network'\nCertificate is to be certified until Mar 28 18:35:29 2027 GMT (825 days)\n\nWrite out database with 1 new entries\nDatabase updated\n\n* Notice:\nCertificate created at: /home/abu/openvpn-ca/pki/issued/server.crt\n</code></pre> </li> <li> <p>Generate Diffie-Hellman Parameters</p> <pre><code>./easyrsa gen-dh\n</code></pre> <pre><code>abu@ABU-PC:~/openvpn-ca$ ./easyrsa gen-dh\n* Notice:\nUsing Easy-RSA configuration from: /home/abu/openvpn-ca/vars\n\n* WARNING:\n\n    Move your vars file to your PKI folder, where it is safe!\n\n* Notice:\nUsing SSL: openssl OpenSSL 3.0.15 3 Sep 2024 (Library: OpenSSL 3.0.15 3 Sep 2024)\n\nGenerating DH parameters, 2048 bit long safe prime\n\n.......................+...........\n...\n</code></pre> </li> </ol>"},{"location":"blog/2023/12/22/openvpn-behind-cgnat/#generate-client-certificates","title":"Generate Client Certificates","text":"<ol> <li> <p>Create a Key Pair for the Client</p> <pre><code>./easyrsa gen-req client1 nopass\n</code></pre> <pre><code>* Notice:\nUsing Easy-RSA configuration from: /home/abu/openvpn-ca/vars\n\n* WARNING:\n\nMove your vars file to your PKI folder, where it is safe!\n\n* Notice:\nUsing SSL: openssl OpenSSL 3.0.15 3 Sep 2024 (Library: OpenSSL 3.0.15 3 Sep 2024)\n\n...........+.+......+...+...........+.+..............+......+...+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.......+..+...+......+.............+......+..+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*....+.........+............+.............+..+.+..+......+.+.....+.+...+..+.......+..+..................+..........+......+.........+...+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\n....+...............+........+...+....+...+............+...+..+.+.....+.+.....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*...+.........+............+......+...+.+...+...+..+.+..+...+.......+.........+.....+....+......+...............+...+..+......+.......+..+...+...+....+..............................+...+......+...........+.+..+.+.....+....+...+.....+.......+..+.+...+.....+.......+..+.......+...+..+................+...+...........+.+..+......+.........+.............+.....+...+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.....+.....+....+...+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\n-----\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\nCommon Name (eg: your user, host, or server name) [client1]:\n* Notice:\n\nKeypair and certificate request completed. Your files are:\nreq: /home/abu/openvpn-ca/pki/reqs/client1.req\nkey: /home/abu/openvpn-ca/pki/private/client1.key\n</code></pre> </li> <li> <p>Sign the client certificate</p> <pre><code>./easyrsa sign-req client client1\n</code></pre> <pre><code>abu@ABU-PC:~/openvpn-ca$ ./easyrsa sign-req client client1\n* Notice:\nUsing Easy-RSA configuration from: /home/abu/openvpn-ca/vars\n\n* WARNING:\n\n    Move your vars file to your PKI folder, where it is safe!\n\n* Notice:\nUsing SSL: openssl OpenSSL 3.0.15 3 Sep 2024 (Library: OpenSSL 3.0.15 3 Sep 2024)\n\n\nYou are about to sign the following certificate.\nPlease check over the details shown below for accuracy. Note that this request\nhas not been cryptographically verified. Please be sure it came from a trusted\nsource or that you have verified the request checksum with the sender.\n\nRequest subject, to be signed as a client certificate for 825 days:\n\nsubject=\n    commonName                = client1\n\n\nType the word 'yes' to continue, or any other input to abort.\n    Confirm request details: yes\n\nUsing configuration from /home/abu/openvpn-ca/pki/af0b8b00/temp.f3b90bfb\nEnter pass phrase for /home/abu/openvpn-ca/pki/private/ca.key:\nCheck that the request matches the signature\nSignature ok\nThe Subject's Distinguished Name is as follows\ncommonName            :ASN.1 12:'client1'\nCertificate is to be certified until Mar 28 18:38:01 2027 GMT (825 days)\n\nWrite out database with 1 new entries\nDatabase updated\n\n* Notice:\nCertificate created at: /home/abu/openvpn-ca/pki/issued/client1.crt\n</code></pre> </li> </ol>"},{"location":"blog/2023/12/22/openvpn-behind-cgnat/#configure-the-openvpn-server","title":"Configure the OpenVPN Server","text":"<ol> <li> <p>Copy the required files to <code>/etc/openvpn</code>:</p> <pre><code>sudo cp ~/openvpn-ca/pki/ca.crt /etc/openvpn/\nsudo cp ~/openvpn-ca/pki/private/server.key /etc/openvpn/\nsudo cp ~/openvpn-ca/pki/issued/server.crt /etc/openvpn/\nsudo cp ~/openvpn-ca/pki/dh.pem /etc/openvpn/\n</code></pre> </li> <li> <p>Create the OpenVPN Server Configuration file</p> <pre><code>sudo vi /etc/openvpn/server.conf\n</code></pre> <p>Add the following content to it.</p> <pre><code>port 443\nproto tcp\ndev tun\nca ca.crt\ncert server.crt\nkey server.key\ndh dh.pem\nserver 10.8.0.0 255.255.255.0\nifconfig-pool-persist ipp.txt\npush \"redirect-gateway def1 bypass-dhcp\"\npush \"dhcp-option DNS 8.8.8.8\"\npush \"dhcp-option DNS 8.8.4.4\"\nkeepalive 10 120\ncipher AES-256-CBC\nuser nobody\ngroup nogroup\npersist-key\npersist-tun\nstatus openvpn-status.log\nverb 3\n</code></pre> </li> </ol>"},{"location":"blog/2023/12/22/openvpn-behind-cgnat/#enable-ip-forwarding","title":"Enable IP Forwarding","text":"<ol> <li> <p>Edit the sysctl configuration.</p> <pre><code>sudo vi /etc/sysctl.conf\n</code></pre> <p>Check if the following line is Present and uncommented or add it.</p> <pre><code>net.ipv4.ip_forward=1\n</code></pre> </li> <li> <p>Apply the changes.</p> <pre><code>sudo sysctl -p\n</code></pre> <pre><code>abu@ABU-PC:~/openvpn-ca$ sudo sysctl -p\nnet.ipv4.ip_forward = 1\n</code></pre> </li> </ol>"},{"location":"blog/2023/12/22/openvpn-behind-cgnat/#configure-firewall","title":"Configure Firewall","text":"<ol> <li> <p>Install iptables-persistent</p> <pre><code>sudo apt install iptables-persistent -y\n</code></pre> </li> <li> <p>Configure NAT rules.</p> <pre><code>sudo iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -o eth0 -j MASQUERADE\n</code></pre> </li> <li> <p>Save the rules</p> <pre><code>sudo sh -c \"iptables-save &gt; /etc/iptables/rules.v4\"\n</code></pre> </li> </ol>"},{"location":"blog/2023/12/22/openvpn-behind-cgnat/#start-and-enable-openvpn","title":"Start and Enable OpenVPN","text":"<ol> <li> <p>Start OpenVPN</p> <pre><code>sudo systemctl start openvpn@server\n</code></pre> </li> <li> <p>Enable OpenVPN to start on boot.</p> <pre><code>sudo systemctl enable openvpn@server\n</code></pre> <pre><code>abu@ABU-PC:~/openvpn-ca$ sudo systemctl enable openvpn@server\nCreated symlink /etc/systemd/system/multi-user.target.wants/openvpn@server.service \u2192 /lib/systemd/system/openvpn@.service.\n</code></pre> </li> </ol>"},{"location":"blog/2023/12/22/openvpn-behind-cgnat/#configure-the-client","title":"Configure the Client","text":"<ol> <li> <p>Create a client configuration file</p> <pre><code>sudo vi client1.ovpn\n</code></pre> </li> <li> <p>Add the following Content, Replace <code>your-ddns-name</code></p> <pre><code>client\ndev tun\nproto tcp\nremote `your-dns-name` `your-dns-port`\nresolv-retry infinite\nnobind\npersist-key\npersist-tun\nremote-cert-tls server\ncipher AES-256-CBC\nverb 3\n&lt;ca&gt;\n# Paste the content of ca.crt here, Check /home/$USER/openvpn-ca/pki/ca.crt\n&lt;/ca&gt;\n&lt;cert&gt;\n# Paste the content of client1.crt here, Check /home/$USER/openvpn-ca/pki/issued/client1.crt\n&lt;/cert&gt;\n&lt;key&gt;\n# Paste the content of client1.key here, Check /home/$USER/openvpn-ca/pki/private/client1.key\n&lt;/key&gt;\n</code></pre> </li> </ol>"},{"location":"blog/2023/12/22/openvpn-behind-cgnat/#test-the-vpn","title":"Test the VPN","text":"<ol> <li> <p>Copy the Phone to PC you want to connect it to.</p> </li> <li> <p>On Windows/Linux PC you can use OpenVPN Client</p> <p>Sucessfully Connected on Windows</p> <p></p> </li> <li> <p>On Android OpenVPN Client or OpenVPN for Android (I prefer this one)</p> <p>Successfully Connected on Android</p> <p></p> </li> </ol>"},{"location":"blog/2023/12/22/openvpn-behind-cgnat/#sources","title":"Sources","text":"<ul> <li>Tunneling OpenVPN sever over CGNAT</li> <li>Guide To Setup UP OpenVPN</li> <li>Webrelay QuickStart Guide</li> </ul>"},{"location":"blog/archive/2023/","title":"2023","text":""}]}